!function(a){"use strict";function b(b,c){function d(){}function e(a,b){var c,d;for(c in b)if(b.hasOwnProperty(c)){switch(d=b[c],c){case"height":case"width":case"marginLeft":case"marginTop":d+="px"}a.style[c]=d}return a}function f(a,b){var c;for(c in b)a[c]=b[c];return a}function g(a,b){return function(){return a.apply(b,Array.prototype.slice.call(arguments))}}function h(a,c){var d;return d=b?b(c).find("."+a):Array.prototype.slice.call(c.getElementsByClassName(a))}function i(a,c,d,f,g){var h={};h[c]=d,b?b(a).animate(h,f,g):e(a,h)}function j(a,b){var c=f({},s);this.settings=f(c,b),this.container=a,this.pageContainer=document.createElement("div"),this.scrollBorder={x:0,y:0},this.page=0,this.preventScroll=!1,this.pageCssProperties={margin:0},this.pageContainer.innerHTML=a.cloneNode(!0).innerHTML,a.innerHTML="",a.appendChild(this.pageContainer),e(a,w),setTimeout(g(function(){this.updateInstance(b),this.settings.preventDrag||this._observe(),this.settings.afterInitialize.call(this)},this),10),r=r?r:e(document.body.appendChild(document.createElement("div")),{width:"1",height:"1"})}function k(a,c,d){b?b(a).on(c,d):a.addEventListener(c,d,!1)}function l(a,c,d){b?b(a).off(c,d):a.removeEventListener(c,d,!1)}var m,n,o,p,q,r,s={pageClass:"dragend-page",direction:"horizontal",minDragDistance:"40",onSwipeStart:d,onSwipeEnd:d,onDragStart:d,onDrag:d,onDragEnd:d,afterInitialize:d,keyboardNavigation:!1,stopPropagation:!1,itemsInPage:1,scribe:0,borderBetweenPages:0,duration:300,preventDrag:!1,hammerSettings:{drag_min_distance:0,css_hacks:!1,prevent_default:!1}},t="ontouchstart"in a,u={37:"left",38:"up",39:"right",40:"down"},v={handling:"Dragend JS detected some problems with the event handling. Maybe the user-drag CSS attribute on images can help",pages:"No pages found"},w={overflow:"hidden",padding:0},x=function(){var a=document.createElement("div"),b="Khtml Ms O Moz Webkit".split(" "),c=b.length;return function(d){if(d in a.style)return!0;for(d=d.replace(/^[a-z]/,function(a){return a.toUpperCase()});c--;)if(b[c]+d in a.style)return!0;return!1}}(),y={_scroll:function(a){var b="horizontal"===this.settings.direction?"translateX("+a.x+"px)":"translateY("+a.y+"px)";e(this.pageContainer,{"-webkit-transform":b,"-moz-transform":b,"-ms-transform":b,"-o-transform":b,transform:b})},_animateScroll:function(){var a="transform "+this.settings.duration+"ms ease-out";n=g(this.afterScrollTransform,this),e(this.pageContainer,{"-webkit-transition":"-webkit-"+a,"-moz-transition":"-moz-"+a,"-ms-transition":"-ms-"+a,"-o-transition":"-o-"+a,transition:a}),this._scroll({x:-this.scrollBorder.x,y:-this.scrollBorder.y}),k(this.container,"webkitTransitionEnd",n),k(this.container,"oTransitionEnd",n),k(this.container,"transitionEnd",n)},afterScrollTransform:function(){this._onSwipeEnd(),l(this.container,"webkitTransitionEnd",n),l(this.container,"oTransitionEnd",n),l(this.container,"transitionEnd",n),e(this.pageContainer,{"-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"",transition:""})}},z={_scroll:function(a){var b="horizontal"===this.settings.direction?{marginLeft:a.x}:{marginTop:a.y};e(this.pageContainer,b)},_animateScroll:function(){var a="horizontal"===this.settings.direction?"marginLeft":"marginTop",b="horizontal"===this.settings.direction?-this.scrollBorder.x:-this.scrollBorder.y;i(this.pageContainer,a,b,this.settings.duration,g(this._onSwipeEnd,this))}};return function(){var a=x("transform");f(j.prototype,a?y:z)}(),f(j.prototype,{_checkOverscroll:function(a,b,c){var d={x:b,y:c,overscroll:!0};switch(a){case"right":if(!this.scrollBorder.x)return d.x=Math.round((b-this.scrollBorder.x)/5),d;break;case"left":if((this.pagesCount-1)*this.pageDimentions.width<=this.scrollBorder.x)return d.x=Math.round(-((Math.ceil(this.pagesCount)-1)*(this.pageDimentions.width+this.settings.borderBetweenPages))+b/5),d;break;case"down":if(!this.scrollBorder.y)return d.y=Math.round((c-this.scrollBorder.y)/5),d;break;case"up":if((this.pagesCount-1)*this.pageDimentions.height<=this.scrollBorder.y)return d.y=Math.round(-((Math.ceil(this.pagesCount)-1)*(this.pageDimentions.height+this.settings.borderBetweenPages))+c/5),d}return{x:b-this.scrollBorder.x,y:c-this.scrollBorder.y,overscroll:!1}},_observe:function(){o=g(this._onDrag,this),p=g(this._onKeydown,this),q=g(this._sizePages,this),c?(this.hammer=new c(this.container,this.settings.hammerSettings),hammer.on("drag",g(this._onDrag,this)).on("dragend",g(this._onDragEnd,this))):t?(k(this.container,"touchstart",g(this._onTouchStart,this)),k(this.container,"touchmove",g(this._onTouchMove,this)),k(this.container,"touchend",g(this._onTouchEnd,this))):(this.container.draggable=!0,k(this.container,"dragstart",g(this._onDragStart,this)),"undefined"!=typeof InstallTrigger?k(document,"dragover",o):k(this.container,"drag",g(this._onDrag,this)),k(this.container,"dragend",g(this._onDragEnd,this))),this.settings.keyboardNavigation&&k(document.body,"keydown",p),k(a,"resize",q)},_onDragStart:function(a){a=a.originalEvent||a;var b=a.dataTransfer;this.settings.stopPropagation&&a.stopPropagation(),b.setDragImage&&b.setDragImage(r,0,0),b.setData&&b.setData("text/html",null),b.effectAllowed="none",b.dropEffect="none",this.startPageX=a.screenX,this.startPageY=a.screenY,this.settings.onDragStart.call(this,a)},_onTouchStart:function(a){a=a.originalEvent||a,this.settings.stopPropagation&&a.stopPropagation(),this.startPageX=a.touches[0].pageX,this.startPageY=a.touches[0].pageY,this.settings.onDragStart.call(this,a)},_onDrag:function(a){return a=a.originalEvent||a,m&&"drag"===a.type&&0===a.x&&0===a.y?(this._onDragEnd(m),void(m=null)):(m=a,void this._onTouchMove(a))},_onTouchMove:function(a){if(a=a.originalEvent||a,!(a.touches&&a.touches.length>1||a.scale&&1!==a.scale)){a.preventDefault(),this.settings.stopPropagation&&a.stopPropagation();var b=t?this._parseTouchEvent(a):this._parseDragEvent(a),c=this._checkOverscroll(b.direction,-b.distanceX,-b.distanceY);this.settings.onDrag.call(this,this.activeElement,b,c.overscroll,a),this.preventScroll||this._scroll(c)}},_onDragEnd:function(a){m&&this._onTouchEnd(a)},_onTouchEnd:function(a){a=a.originalEvent||a,this.settings.stopPropagation&&a.stopPropagation();var b=t?this._parseTouchEvent(a):this._parseDragEvent(a);this.startPageX=0,this.startPageY=0,Math.abs(b.distanceX)>this.settings.minDragDistance||Math.abs(b.distanceY)>this.settings.minDragDistance?this.swipe(b.direction):this._scrollToPage(),this.settings.onDragEnd.call(this,this.container,this.activeElement,this.page,a)},_parseTouchEvent:function(a){var b=a.touches&&a.touches.length?a.touches:a.changedTouches,c=this.startPageX-b[0].pageX,d=this.startPageY-b[0].pageY;return this._addDistanceValues(c,d)},_parseDragEvent:function(a){var b=a.gesture?a.gesture.deltaX:this.startPageX-a.screenX,c=a.gesture?a.gesture.deltaY:this.startPageY-a.screenY;return this._addDistanceValues(b,c)},_addDistanceValues:function(a,b){var c={distanceX:0,distanceY:0};return"horizontal"===this.settings.direction?(c.distanceX=a,c.direction=a>0?"left":"right"):(c.distanceY=b,c.direction=b>0?"up":"down"),c},_onKeydown:function(a){var b=u[a.keyCode];b&&this._scrollToPage(b)},_setHorizontalContainerCssValues:function(){f(this.pageCssProperties,{cssFloat:"left",overflowY:"auto",overflowX:"hidden",padding:0,display:"block"}),e(this.pageContainer,{overflow:"hidden",width:(this.pageDimentions.width+this.settings.borderBetweenPages)*this.pagesCount,boxSizing:"content-box","-webkit-backface-visibility":"hidden","-webkit-perspective":1e3,margin:0,padding:0})},_setVerticalContainerCssValues:function(){f(this.pageCssProperties,{overflow:"hidden",padding:0,display:"block"}),e(this.pageContainer,{"padding-bottom":this.settings.scribe,boxSizing:"content-box","-webkit-backface-visibility":"hidden","-webkit-perspective":1e3,margin:0})},setContainerCssValues:function(){"horizontal"===this.settings.direction?this._setHorizontalContainerCssValues():this._setVerticalContainerCssValues()},_setPageDimentions:function(){var a=this.container.offsetWidth,b=this.container.offsetHeight;"horizontal"===this.settings.direction?a-=parseInt(this.settings.scribe,10):b-=parseInt(this.settings.scribe,10),this.pageDimentions={width:a,height:b}},_sizePages:function(){var a=this.pages.length;this._setPageDimentions(),this.setContainerCssValues(),"horizontal"===this.settings.direction?f(this.pageCssProperties,{height:this.pageDimentions.height,width:this.pageDimentions.width/this.settings.itemsInPage}):f(this.pageCssProperties,{height:this.pageDimentions.height/this.settings.itemsInPage,width:this.pageDimentions.width});for(var b=0;a>b;b++)e(this.pages[b],this.pageCssProperties);this._jumpToPage("page",this.page)},_calcNewPage:function(a,b){var c=this.settings.borderBetweenPages,d=this.pageDimentions.height,e=this.pageDimentions.width,f=this.page;switch(a){case"up":f<this.pagesCount-1&&(this.scrollBorder.y=this.scrollBorder.y+d+c,this.page++);break;case"down":f>0&&(this.scrollBorder.y=this.scrollBorder.y-d-c,this.page--);break;case"left":f<this.pagesCount-1&&(this.scrollBorder.x=this.scrollBorder.x+e+c,this.page++);break;case"right":f>0&&(this.scrollBorder.x=this.scrollBorder.x-e-c,this.page--);break;case"page":switch(this.settings.direction){case"horizontal":this.scrollBorder.x=(e+c)*b;break;case"vertical":this.scrollBorder.y=(d+c)*b}this.page=b;break;default:this.scrollBorder.y=0,this.scrollBorder.x=0,this.page=0}},_onSwipeEnd:function(){this.preventScroll=!1,this.activeElement=this.pages[this.page*this.settings.itemsInPage],this.settings.onSwipeEnd.call(this,this.container,this.activeElement,this.page)},_jumpToPage:function(a,b){a&&this._calcNewPage(a,b),this._scroll({x:-this.scrollBorder.x,y:-this.scrollBorder.y})},_scrollToPage:function(a,b){this.preventScroll=!0,a&&this._calcNewPage(a,b),this._animateScroll()},swipe:function(a){this.settings.onSwipeStart.call(this,this.container,this.activeElement,this.page),this._scrollToPage(a)},updateInstance:function(a){if(a=a||{},"object"==typeof a&&f(this.settings,a),this.pages=h(this.settings.pageClass,this.pageContainer),!this.pages.length)throw new Error(v.pages);this.pagesCount=this.pages.length/this.settings.itemsInPage,this.activeElement=this.pages[this.page*this.settings.itemsInPage],this._sizePages(),this.settings.jumpToPage&&(this.jumpToPage(a.jumpToPage),delete this.settings.jumpToPage),this.settings.scrollToPage&&(this.scrollToPage(this.settings.scrollToPage),delete this.settings.scrollToPage)},destroy:function(){var b=this.container;this.hammer&&this.hammer.off("drag").off("dragend"),l(b,"touchstart"),l(b,"touchmove"),l(b,"touchend"),l(b,"dragstart"),l(b,"drag"),l(b,"dragend"),l(document,"dragover",o),l(document.body,"keydown",p),l(a,"resize",q),b.removeAttribute("style");for(var c=0;c<this.pages.length;c++)this.pages[c].removeAttribute("style");b.innerHTML=this.pageContainer.innerHTML},scrollToPage:function(a){this._scrollToPage("page",a-1)},jumpToPage:function(a){this._jumpToPage("page",a-1)}}),b&&(b.fn.dragend=function(a){return a=a||{},this.each(function(){var c=b(this).data("dragend");c?c.updateInstance(a):(c=new j(this,a),b(this).data("dragend",c)),"string"==typeof a&&c.swipe(a)}),this}),j}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return b(a.jQuery||a.Zepto,a.Hammer)}):a.Dragend=b(a.jQuery||a.Zepto,a.Hammer)}(window);